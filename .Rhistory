for(i in 1:nrow(anc)){
d <- rep(0,nrow(anc))
anc2 <- ancfin
for(j in 1:nrow(anc)){
anc2[i,] <- anc[j,]
rd2 <- RainDrops(dat,anc2)
plot(rd2$points,pch=21,bg=col)
d[j] <- sum(dist(rd2$points))
}
m <- which(d == max(d))
ancfin[i,] <-anc[m,]
}
return(RainDrops(dat,anc))
}
optimRD(dat.dg)
optimRD <- function(dat){
rd <- RainDrops(dat)
anc <- rd$anchors
ancfin <- rd$anchors
col <- as.factor(1:nrow(rd$points))
for(i in 1:nrow(anc)){
d <- rep(0,nrow(anc))
anc2 <- ancfin
for(j in 1:nrow(anc)){
anc2[i,] <- anc[j,]
rd2 <- RainDrops(dat,anc2)
plot(rd2$points,pch=21,bg=col)
d[j] <- min(dist(rd2$points))
}
m <- which(d == max(d))
ancfin[i,] <-anc[m,]
}
return(RainDrops(dat,anc))
}
optimRD(dat.dg)
optimRD(dat.dg)
optimRD(dat.dg)
optimRD <- function(dat){
rd <- RainDrops(dat)
anc <- rd$anchors
ancfin <- rd$anchors
col <- as.factor(1:nrow(rd$points))
for(i in 1:nrow(anc)){
d <- rep(0,nrow(anc))
anc2 <- ancfin
for(j in 1:nrow(anc)){
anc2[i,] <- anc[j,]
rd2 <- RainDrops(dat,anc2)
plot(rd2$points,pch=21,bg=col)
d[j] <- min(dist(rd2$points))
}
m <- which(d == max(d))
ancfin[i,] <-anc[m,]
}
return(RainDrops(dat,ancfin))
}
optimRD(dat.dg)
optimRD <- function(dat){
rd <- RainDrops(dat)
anc <- rd$anchors
ancfin <- rd$anchors
col <- as.factor(1:nrow(rd$points))
for(i in 1:nrow(anc)){
d <- rep(0,nrow(anc))
anc2 <- ancfin
for(j in 1:nrow(anc)){
anc2[i,] <- anc[j,]
rd2 <- RainDrops(dat,anc2)
plot(rd2$points,pch=21,bg=col)
d[j] <- min(dist(rd2$points))
}
m <- which(d == min(d))
ancfin[i,] <-anc[m,]
}
return(RainDrops(dat,ancfin))
}
optimRD(dat.dg)
nrow(anc)
optimRD <- function(dat){
rd <- RainDrops(dat)
anc <- rd$anchors
ancfin <- rd$anchors
col <- as.factor(1:nrow(rd$points))
for(i in 1:nrow(anc)){
d <- rep(0,nrow(anc))
anc2 <- ancfin
for(j in 1:nrow(anc)){
anc2[i,] <- anc[j,]
rd2 <- RainDrops(dat,anc2)
plot(rd2$points,pch=21,bg=col)
d[j] <- min(dist(rd2$points))
}
m <- which(d == min(d))
print(i)
ancfin[i,] <-anc[m,]
}
return(RainDrops(dat,ancfin))
}
optimRD(dat.dg)
optimRD <- function(dat){
rd <- RainDrops(dat)
anc <- rd$anchors
ancfin <- rd$anchors
col <- as.factor(1:nrow(rd$points))
for(i in 1:nrow(anc)){
d <- rep(0,nrow(anc))
anc2 <- ancfin
for(j in 1:nrow(anc)){
anc2[i,] <- anc[j,]
rd2 <- RainDrops(dat,anc2)
plot(rd2$points,pch=21,bg=col)
d[j] <- min(dist(rd2$points))
}
m <- which(d == min(d))
print(i)
print(ancfin[i,])
print(anc[m,])
ancfin[i,] <- anc[m,]
}
return(RainDrops(dat,ancfin))
}
optimRD(dat.dg)
m
rd <- RainDrops(dat)
anc <- rd$anchors
ancfin <- rd$anchors
col <- as.factor(1:nrow(rd$points))
i <- 1
d <- rep(0,nrow(anc))
anc2 <- ancfin
for(j in 1:nrow(anc)){
anc2[i,] <- anc[j,]
rd2 <- RainDrops(dat,anc2)
plot(rd2$points,pch=21,bg=col)
d[j] <- min(dist(rd2$points))
}
dat <- dat.dg
for(j in 1:nrow(anc)){
anc2[i,] <- anc[j,]
rd2 <- RainDrops(dat,anc2)
plot(rd2$points,pch=21,bg=col)
d[j] <- min(dist(rd2$points))
}
d
m <- which(d == min(d))
m
md <- rep(0,nrow(anc))
anc2 <- ancfin
for(j in 1:nrow(anc)){
anc2[i,] <- anc[j,]
rd2 <- RainDrops(dat,anc2)
plot(rd2$points,pch=21,bg=col)
d[j] <- sum(dist(rd2$points))
}
m <- which(d == min(d))
m
d
m <- which(d == max(d))
m
print(anc[m,])
print(ancfin[i,])
ancfin[i,] <- anc[m,]
ancfin[i,] <- anc[m,]rd <- RainDrops(dat)
anc <- rd$anchors
ancfin <- rd$anchors
col <- as.factor(1:nrow(rd$points))
for(i in 1:nrow(anc)){
d <- rep(0,nrow(anc))
anc2 <- ancfin
for(j in 1:nrow(anc)){
anc2[i,] <- anc[j,]
rd2 <- RainDrops(dat,anc2)
plot(rd2$points,pch=21,bg=col)
d[j] <- sum(dist(rd2$points))
}
m <- which(d == max(d))
print(i)
print(ancfin[i,])
print(anc[m,])
ancfin[i,] <- anc[m,]
}
m
d
i
rd <- RainDrops(dat)
anc <- rd$anchors
ancfin <- rd$anchors
col <- as.factor(1:nrow(rd$points))
for(i in 1:nrow(anc)){
d <- rep(0,nrow(anc))
anc2 <- ancfin
for(j in 1:nrow(anc)){
anc2[i,] <- anc[j,]
rd2 <- RainDrops(dat,anc2)
plot(rd2$points,pch=21,bg=col)
d[j] <- sum(dist(rd2$points))
}
m <- which(d == max(d))[1]
print(i)
print(ancfin[i,])
print(anc[m,])
ancfin[i,] <- anc[m,]
}
bases <- c('G','A','T','C')
A <- sample(bases,150,replace=TRUE)
B <- sample(bases,150,replace=TRUE)
C <- sample(bases,150,replace=TRUE)
D <- sample(bases,150,replace=TRUE)
E <- sample(bases,150,replace=TRUE)
dat <- t(data.frame(A,B,C,D,E))
dat.dg <- df.to.digi(dat)
#######
# function to calculate RadViz point coordinates
# adapted from Twitter: @WilliamAHuber
# from https://stats.stackexchange.com/questions/58001/how-to-plot-a-5d-data-set-in-star-coordinates
RainDrops <- function(x,anc=NULL){
d <- dim(x)[2] # Dimensions
if(is.null(anc)){ anchors <- t(sapply((1:d)/d, function(i) c(cos(2*pi*i), sin(2*pi*i))))
}else(anchors = anc)
points <- as.matrix(x) %*% anchors
return(list(anchors=anchors,points=points))
}
optimRD <- function(dat){
rd <- RainDrops(dat)
anc <- rd$anchors
ancfin <- rd$anchors
col <- as.factor(1:nrow(rd$points))
for(i in 1:nrow(anc)){
d <- rep(0,nrow(anc))
anc2 <- ancfin
for(j in 1:nrow(anc)){
anc2[i,] <- anc[j,]
rd2 <- RainDrops(dat,anc2)
#plot(rd2$points,pch=21,bg=col)
d[j] <- sum(dist(rd2$points))
}
m <- which(d == max(d))[1]
print(i)
print(ancfin[i,])
print(anc[m,])
ancfin[i,] <- anc[m,]
rd3 <- RainDrops(dat,ancfin)
plot(rd3$points,pch=21,bg=col,cex=2)
}
return(RainDrops(dat,ancfin))
}
optimRD(dat.dg)
dat
add.err <- function(df,line,n,sb){
# function to add some error to seq
# df =dataframe with seq, line =line, n= number of new seqs with error, sb = number of errors per seq 
bases <- c('G','A','T','C')
datnew <- c()
for(i in 1:n){
linenew <- df[line, ]
for(b in 1:sb){
linenew[sample(1:ncol(df),1)] <- sample(bases,1)
}
datnew <- rbind(datnew,linenew)
}
rownames(datnew) <- rep(rownames(df)[line],n)
return(datnew)
}
dat <- rbin(add.err(dat,1,50),add.err(dat,2,50),add.err(dat,3,50))
dat <- rbind(add.err(dat,1,50),add.err(dat,2,50),add.err(dat,3,50))
dat <- rbind(add.err(dat,1,50,1),add.err(dat,2,50,1),add.err(dat,3,50,1))
dat[1:10,1:5]
dat
bases <- c('G','A','T','C')
A <- sample(bases,150,replace=TRUE)
B <- sample(bases,150,replace=TRUE)
C <- sample(bases,150,replace=TRUE)
D <- sample(bases,150,replace=TRUE)
E <- sample(bases,150,replace=TRUE)
dat <- t(data.frame(A,B,C,D,E))
##
dat.err <- rbind(add.err(dat,1,50,1),add.err(dat,1,50,0), add.err(dat,1,100,2),add.err(dat,2,300,1),add.err(dat,2,50,0),add.err(dat,2,500,3),add.err(dat,3,500,1),add.err(dat,4,500,1),add.err(dat,5,500,1))
dat <- rbind(dat,dat.err)
dat[1:10,1:6]
rownames(dat)
dat.dg <- dat.to.digi(dat)
dat.dg <- df.to.digi(dat)
rownames(dat.dg)
optimRD <- function(x,centers, ...){
rd <- RainDrops(centers)
anc <- rd$anchors
ancfin <- rd$anchors
for(i in 1:nrow(anc)){
d <- rep(0,nrow(anc))
anc2 <- ancfin
for(j in 1:nrow(anc)){
anc2[i,] <- anc[j,]
rd2 <- RainDrops(centers,anc2)
#plot(rd2$points,pch=21,bg=col)
d[j] <- sum(dist(rd2$points))
}
m <- which(d == max(d))[1]
ancfin[i,] <- anc[m,]
rd3 <- RainDrops(x,ancfin)
plot(rd3$points,pch=21,bg=col,cex=2, ...)
}
return(RainDrops(dat,ancfin))
}
optimRD(dat.dg,dat.dg[1:5,],col=rownames(dat))
optimRD(dat.dg,dat.dg[1:5,],col=as.factor(rownames(dat)9)
optimRD(dat.dg,dat.dg[1:5,],col=as.factor(rownames(dat)))
as.factor(rownames(dat))
optimRD <- function(x,centers, ...){
rd <- RainDrops(centers)
anc <- rd$anchors
ancfin <- rd$anchors
for(i in 1:nrow(anc)){
d <- rep(0,nrow(anc))
anc2 <- ancfin
for(j in 1:nrow(anc)){
anc2[i,] <- anc[j,]
rd2 <- RainDrops(centers,anc2)
#plot(rd2$points,pch=21,bg=col)
d[j] <- sum(dist(rd2$points))
}
m <- which(d == max(d))[1]
ancfin[i,] <- anc[m,]
rd3 <- RainDrops(x,ancfin)
plot(rd3$points,pch=21,cex=2, ...)
}
return(RainDrops(dat,ancfin))
}
optimRD(dat.dg)
optimRD(dat.dg,dat.dg[1:5,])
optimRD(dat.dg,dat.dg[1:5,],bg=as.factor(rownames(dat)))
optimRD <- function(x,centers, ...){
rd <- RainDrops(centers)
anc <- rd$anchors
ancfin <- rd$anchors
plot(rd2$points,pch=21,cex=2, ...)
for(i in 1:nrow(anc)){
d <- rep(0,nrow(anc))
anc2 <- ancfin
for(j in 1:nrow(anc)){
anc2[i,] <- anc[j,]
rd2 <- RainDrops(centers,anc2)
#plot(rd2$points,pch=21,bg=col)
d[j] <- sum(dist(rd2$points))
}
m <- which(d == max(d))[1]
ancfin[i,] <- anc[m,]
rd3 <- RainDrops(x,ancfin)
plot(rd3$points,pch=21,cex=2, ...)
}
return(RainDrops(dat,ancfin))
}
optimRD(dat.dg,dat.dg[1:5,],bg=as.factor(rownames(dat)))
optimRD <- function(x,centers, ...){
rd <- RainDrops(centers)
anc <- rd$anchors
ancfin <- rd$anchors
rdx <- RainDrops(x)
plot(rdx$points,pch=21,cex=2, ...)
for(i in 1:nrow(anc)){
d <- rep(0,nrow(anc))
anc2 <- ancfin
for(j in 1:nrow(anc)){
anc2[i,] <- anc[j,]
rd2 <- RainDrops(centers,anc2)
#plot(rd2$points,pch=21,bg=col)
d[j] <- sum(dist(rd2$points))
}
m <- which(d == max(d))[1]
ancfin[i,] <- anc[m,]
rd3 <- RainDrops(x,ancfin)
plot(rd3$points,pch=21,cex=2, ...)
}
return(RainDrops(dat,ancfin))
}
optimRD(dat.dg,dat.dg[1:5,],bg=as.factor(rownames(dat)))
optimRD <- function(x,centers, ...){
rd <- RainDrops(centers)
anc <- rd$anchors
ancfin <- rd$anchors
rdx <- RainDrops(x)
plot(rdx$points,pch=21,cex=2, ...)
for(i in 1:nrow(anc)){
d <- rep(0,nrow(anc))
anc2 <- ancfin
for(j in 1:nrow(anc)){
anc2[i,] <- anc[j,]
rd2 <- RainDrops(centers,anc2)
plot(rd2$points,pch=21, ...)
d[j] <- sum(dist(rd2$points))
}
m <- which(d == max(d))[1]
ancfin[i,] <- anc[m,]
rd3 <- RainDrops(x,ancfin)
plot(rd3$points,pch=21,cex=2, ...)
}
return(RainDrops(dat,ancfin))
}
optimRD(dat.dg,dat.dg[1:5,],bg=as.factor(rownames(dat)))
optimRD <- function(x,centers, ...){
rd <- RainDrops(centers)
anc <- rd$anchors
ancfin <- rd$anchors
rdx <- RainDrops(x)
plot(rdx$points,pch=21,cex=2, ...)
for(i in 1:nrow(anc)){
d <- rep(0,nrow(anc))
anc2 <- ancfin
for(j in 1:nrow(anc)){
anc2[i,] <- anc[j,]
rd2 <- RainDrops(centers,anc2)
rd3 <- RainDrops(x,ancfin)
plot(rd3$points,pch=21,cex=2, ...)
d[j] <- sum(dist(rd2$points))
}
m <- which(d == max(d))[1]
ancfin[i,] <- anc[m,]
rd3 <- RainDrops(x,ancfin)
plot(rd3$points,pch=21,cex=2, ...)
}
return(RainDrops(dat,ancfin))
}
optimRD(dat.dg,dat.dg[1:5,],bg=as.factor(rownames(dat)))
optimRD <- function(x,centers, ...){
rd <- RainDrops(centers)
anc <- rd$anchors
ancfin <- rd$anchors
rdx <- RainDrops(x)
plot(rdx$points,pch=21,cex=2, ...)
for(i in 1:nrow(anc)){
d <- rep(0,nrow(anc))
anc2 <- ancfin
for(j in 1:nrow(anc)){
anc2[i,] <- anc[j,]
rd2 <- RainDrops(centers,anc2)
#rd3 <- RainDrops(x,ancfin)
#plot(rd3$points,pch=21,cex=2, ...)
d[j] <- sum(dist(rd2$points))
}
m <- which(d == max(d))[1]
ancfin[i,] <- anc[m,]
rd3 <- RainDrops(x,ancfin)
plot(rd3$points,pch=21,cex=2, ...)
}
return(RainDrops(dat,ancfin))
}
optimRD(dat.dg,dat.dg[1:5,],bg=as.factor(rownames(dat)))
S <- optimRD(dat.dg,dat.dg[1:5,],bg=as.factor(rownames(dat)))
q()
library(dada2pp)
?jackki
document()
getwd()
setwd( "C:/Users/pmartinez/Documents/GitHub/dada2pp/")
document()
library(devtools)
document()
document()
install_github("pmartinezarbizu/dada2pp")
library(dada2pp)
?jackki
library(vegan)
?jackki
?dotchart
document()
document()
install_github("pmartinezarbizu/dada2pp")
install_github("pmartinezarbizu/dada2pp")
library(dada2pp)
?jackki
library(vegan)
data(dune)
data(dune.env)
x <- jackki(dune~Management,data=dune.env)
plot(x)
x
plot(x)
plot(x)
install_github("pmartinezarbizu/dada2pp")
library(dada2pp)
?jackki
library(vegan)
data(dune)
data(dune.env)
x <- jackki(dune~Management,data=dune.env)
plot(x)
x
plot(x)
plot(x)
library(dada2pp)
?jackki
plot(x)
plot(x)
x
abline(v=x$jackknife[1],lty=1,lwd=4,col=rgb(20,20,100,alpha=50,max=255)) 
abline(v=c(x$jackknife[3],x$jackknife[4]),lty=2,col=rgb(20,20,100,alpha=50,max=255))
plot.jackki <- function(x, reduce = FALSE, pch=rev(c(21,22,24)[x$res$rel.effect]), pt.cex=1.3, bg='white',  ... ){
xmin <-  min( c(x$res$F.Model,x$jackknife$low95CI))
xmax <- max( c(x$res$F.Model,x$jackknife$up95CI))
if(reduce){x$res <-  x$res[!(x$res$rel.effect == 'n.s.'),] }
dotchart(x$res$F.Model,1:nrow(x$res),
labels=x$res$variable,xlab='F.Model',
ylab='',
xlim=c(xmin,xmax),
pch=pch,
bg=bg,
... )
abline(v=x$jackknife[1],lty=1,lwd=4,col=rgb(20,20,100,alpha=50,max=255)) 
abline(v=c(x$jackknife[3],x$jackknife[4]),lty=2,col=rgb(20,20,100,alpha=50,max=255))
}
plot(x)
plot(x)
q()
